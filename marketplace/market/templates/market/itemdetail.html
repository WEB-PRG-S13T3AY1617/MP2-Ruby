{% load static %}
<html>
    <head><title>View Item</title>
        <link rel="stylesheet" type="text/css" href="{%static 'market/itemstyle.css' %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    </head>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
        <script>
        $(document).on("keypress", ".search", function(e) {
            if (e.which == 13) {
            
            }
        });
    
</script>
   
    <body>
        <div id = page>
           <div class = "bar-container">
                <div class = "bar">
                    <div class = "item-container">
                        {% if user.is_authenticated == True %}
                        <div class = "bar-item">Hi, <a href="{% url 'market:user' user.id %}"> {{ user.username }} </a> !</div>
                        {% else %}
                        <a href="/register/"><div class = "bar-item">Register</div></a>
                        {% endif %}
                        
                        {% if user.is_authenticated == True %}
                        <a href="/logout/">
                            <div class = "bar-item">Logout</div>
                            </a>
                        {% else %}
                        <a href="/login/">
                            <div class = "bar-item">Login</div>
                        </a>
                         {% endif %}
                    </div>
                </div>
            </div>
            <div class = "bar-container">
                <div class = "a-container">
                    <div class = "left-container"> </div>
                    <div class = "middle-container">
                        <img src = "{%static 'photos/rccshop.png' %}" width="300" height="200" class = "rcc"/>
                    </div>
                    <div class = "right-container">
     <form action="{% url 'market:searchpic' %}">
     	<input type="text" class="search" name = "tag" placeholder="Search tag..." style="background-image:url('{%static 'photos/magnifyglass.png' %}')">
     </form>
</div>

                </div>
            </div>
            <div class = "bar-container">
                <div class = "menu">
                    <div class = "b-container">
                        <a href="/market"><div class = "home"> <span class = "t"> Home </span> </div></a>
                        <a href="/market/postanitem"><div class = "ppost"> <span class = "s"> Post an Item </span> </div></a>
                    </div>
                </div>
            </div>
            
            
            <div id ="main-container">
                <div id="photobox">
                    <div class="pics" id="p1" > 
                       <a href="#openModal1"><img src= "{{ post.tb_img.url }}" id ="thumb" class="hover-shadow cursor" alt="no photo loaded yet"></a>
                    </div>
                    {% if user.username != post.user.username %}
                    {% if user.is_anonymous == False %}
                    <div>
                        <a href="?userid={{user.id}}"><p id="myBtn2"> Make an offer? </p></a>
                        
                    </div>
                    {% endif %}
                    {% endif %}
                    
                    {% if user.is_anonymous == False %}
                    <div>
                        {% for offer in list_offer %}  
                            {% if offer.user.id == user.id and offer.post.id == post.id%} 
                            <a href="?offertoid={{offer.id}}&userid={{user.id}}"><p id="myBtn2 "> View your offer. </p></a>
                       {{ "<!--" }}
                          {%endif%} 
                        {%endfor%}     
                        {{ "-->" }}
                    </div>
                    {% endif %}
                </div>
                
                <div class = "detail-info">
                    <div>Itemname: {{post.itemname}}</div>
                    <div>Quantity x {{post.quantity}}</div>
                    <div>Condition: <a href = "{% url 'market:searchcondition' post.condition %}"> {{post.me}}</a></div>
                    <div>Type: <a href = "{% url 'market:searchtype' post.posttypes %}">{{post.posttypes}}</a></div>
                    {%if post.posttypes == "Academic"%}
                    <div>Course Name: <a href = "{% url 'market:searchcourse' post.coursename %}">{{post.coursename}}</a></div>
                    {%endif%}
                    <div>Tag:<a href = "{% url 'market:searchtag' post.tag %}"> #{{post.tag}}</a></div>
                   <div> posted by <a href = "{% url 'market:user' post.user.id %}">{{post.user.username}}</a></div>
                </div>
                    
                

               
            </div>

            <div id="openModal1" class="modalDialog">
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                    <img  src= "{{ post.tb_img.url }}" id="photo" alt="No photo loaded yet">
                </div>
            </div>
            
            <!-- The Modal -->
            <div id="openModal2" class="modalDialog">
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                    <div>{{post.itemname}}</div>
                    <form action="{% url 'market:makeoffer' post.id %}" method="POST" >
                        {% csrf_token %}
                        
                        <div>
                        <input type="text" name="userid" value="{{user.id}}" style = "display: none"/>
                        <label for="offertype">Type of Offer: </label>
                        <select name="offertype" id="offertype" required>
                        <option value="" disabled selected>Select your option</option>
                        <option value = "Purchase">Purchase</option>
                        <option value = "Exchange">Exchange</option>
                        </select>  
                        </div>
                        
                        <div id="items">
                        <label for="items">Your Items: </label>
                        <select name="items" id="youritem">
                            <option value="" disabled selected>Select an item</option>
                            
                            {%for items in buyeritems%}
                            <option value = "{{items.id}}">{{items.itemname}}</option>
                            {%endfor%}
                        </select>
                        </div>
                    <div id="amount">
                        <label for="amount"> Amount Due: </label>
                            <input id="youramount" type="number" name="amount" min=0 step="0.01">
                    </div>
                        <button type="submit" class="button" onclick=""> SUBMIT </button>  
                    </form>
                </div>
            </div>
            
            
<div id ="openModal3" class = "modalDialog">
                                        
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                    {%if offertoobj != None %}
                         <div id = detailoff>
                             <div class = offername>Offer name: {{offertoobj.post.itemname}}</div>
                                <div class = offertype>Offer Type: For {{offertoobj.offertypes}}</div>
                                    {% if offertoobj.offertypes == "Purchase" %}
                                        <div class = amount>Amount: P{{offertoobj.amount}}</div>
                                    
                                    {% elif offertoobj.offertypes == "Exchange" %}
                                        <img  src= "{{ offertoobj.exchangepost.tb_img.url }}" id="thumb" alt="No photo loaded yet">
                                        <div class = amount>Exchange Post: {{offertoobj.exchangepost}}</div>
                                    {% endif%}
                        <div id="btnbox2">
                             <div id="btna"class="btnupd" name="Update" onclick="openbtnboxU();">Update</div>
                             <div class="spacer"></div>
                             
                             <div id="btnd"class="btncncl" name="Cancel" onclick="openbtnboxC();">Cancel</div>
                             <div class="spacer"></div>
                         </div>
                           </div>  
                    <div id = "confirmU">
                        <div id ="confirmnameU">Confirmation</div>
                            <div id ="btnD">
                                <form action="{% url 'market:update' offertoobj.id %}" method="post">
                                    {% csrf_token %}
                                    <div>
                                        <label for="offertype1">Type of Offer: </label>
                                        <select name="offertype1" id="offertype1">
                                        <option value="" disabled selected>Select your option</option>
                                        <option value = "Purchase">Purchase</option>
                                        <option value = "Exchange">Exchange</option>
                                        </select>  
                                    </div>
                        
                                    <div id="items1">
                                    <label for="items1">Your Items: </label>
                                    <select id="youritem" name="item">
                                        <option value="null" disabled selected>Select an item</option>

                                        {%for items1 in buyeritems%}
                                        {%if items1.id != offer.exchangepost.id%}
                                        <option value = "{{items1.id}}">{{items1.itemname}}</option>
                                        {%endif%}
                                        {%endfor%}
                                    </select>
                                    </div>
                                    <div id="amount1">
                                        <label for="amount1"> Amount Due: </label>
                                            <input type="number" name="amount" min=0>
                                    </div>
                                    
                                    
                                    <div id = "btn">
                                        <button  class="btnacc"  name="accept" type="submit" >Yes</button>
                                       
                                       <div class="btndec" name="decline" onclick="closeModal();">No</div>
                                        
                                    </div>

                                </form>
                             </div>
                         
                    </div>

                    <div id = "confirmC">
                        <div id ="confirmnameC">Confirmation</div>
                            <div id ="btnD">
                                <form action="{% url 'market:cancel' offertoobj.id %}" method="post">
                                    {% csrf_token %}
                                    <div id = "btn">
                                        <button  class="btnacc"  name="accept" type="submit" >Yes</button>
                                       
                                       <div class="btndec" name="decline" onclick="closeModal();">No</div>
                                        
                                    </div>

                                </form>
                             </div>
                         
                    </div>
                            
                             

                    
                     {% endif%}
                            
                                       
                    
                </div>
            </div>
        </div>
    </body>
    <script>
        $(document).ready(function () {
            $("#amount").hide();
            $("#items").hide();
            if(window.location.href.indexOf("userid") != -1) {
                window.location.hash = '#openModal2';
                $("#amount").hide();
                $("#items").hide();
                
            }
                        if(window.location.href.indexOf("offertoid") != -1) 
                {
                    window.location.hash = '#openModal3';
                    $("#confirmU").css({"visibility": "hidden"});
                    $("#confirmC").css({"visibility": "hidden"});
                    $("#amount1").hide();
                    $("#items1").hide();
                
                }
            });
        
            $("#offertype").change(function(){
                if(this.value == 'Exchange') {
                    $("#amount").hide();
                    $("#items").show();
                    $("#youritem").attr("required", "true")
                } else if(this.value == 'Purchase') {
                    $("#items").hide();
                    $("#amount").show();
                     $("#youramount").attr("required", "true")
                }
            });
            
            $("#offertype1").change(function(){
                if(this.value == 'Exchange') {
                    $("#amount1").hide();
                    $("#items1").show();
                } else if(this.value == 'Purchase') {
                    $("#items1").hide();
                    $("#amount1").show();
                }
              
            });
        
         function openbtnboxU()
             {
                 
                 $("#confirmU").css({"visibility": "visible"});
                 $("#confirmC, #x").css({"visibility": "hidden"});
                 $("#confirmnameU").html("<p>Confirmation: To Update</p>");
                 $("#detailoff").css({"visibility": "hidden"});
             }
        function closeModal()
             {
                  window.location.hash = '#x';
             }
        
        function openbtnboxC()
             {
                 
                 $("#confirmC").css({"visibility": "visible"});
                 $("#confirmU, #x").css({"visibility": "hidden"});
                 $("#confirmnameC").html("<p>Confirmation: To Cancel</p>");
                 $("#detailoff").css({"visibility": "hidden"});
             }
        
    </script>
</html>
