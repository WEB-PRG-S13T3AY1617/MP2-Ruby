{% load static %}
<html>
    <head><title>View Item</title>
        <link rel="stylesheet" type="text/css" href="{%static 'market/itemstyle.css' %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    </head>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
        <script>
        $(document).on("keypress", ".search", function(e) {
            if (e.which == 13) {
            
            }
        });
    
</script>
   
    <body>
        <div id = page>
           <div class = "bar-container">
                <div class = "bar">
                    <div class = "item-container">
                        {% if user.is_authenticated == True %}
                        <div class = "bar-item">Hi, <a href="{% url 'market:user' user.id %}"> {{ user.username }} </a> !</div>
                        {% else %}
                        <a href="/register/"><div class = "bar-item">Register</div></a>
                        {% endif %}
                        
                        {% if user.is_authenticated == True %}
                        <a href="/logout/">
                            <div class = "bar-item">Logout</div>
                            </a>
                        {% else %}
                        <a href="/login/">
                            <div class = "bar-item">Login</div>
                        </a>
                         {% endif %}
                    </div>
                </div>
            </div>
            <div class = "bar-container">
                <div class = "a-container">
                    <div class = "left-container"> </div>
                    <div class = "middle-container">
                        <img src = "{%static 'photos/rccshop.png' %}" width="300" height="200" class = "rcc"/>
                    </div>
                    <div class = "right-container">
     <form action="{% url 'market:searchpic' %}">
     	<input type="text" class="search" name = "tag" placeholder="Search tag..." style="background-image:url('{%static 'photos/magnifyglass.png' %}')">
     </form>
</div>

                </div>
            </div>
            <div class = "bar-container">
                <div class = "menu">
                    <div class = "b-container">
                        <a href="/market"><div class = "home"> <span class = "t"> Home </span> </div></a>
                        <a href="/market/postanitem"><div class = "ppost"> <span class = "s"> Post an Item </span> </div></a>
                    </div>
                </div>
            </div>
            
            
            <div id ="main-container">
                <div id="photobox">
                    <div class="pics" id="p1" > 
                       <a href="#openModal1"><img src= "{{ post.tb_img.url }}" id ="thumb" class="hover-shadow cursor" alt="no photo loaded yet"></a>
                    </div>
                    {% if user.username != post.user.username %}
                    {% if user.is_anonymous == False %}
                    <div>
                        <a href="?userid={{user.id}}"><p id="myBtn2"> Make an offer? </p></a>
                        
                    </div>
                    {% endif %}
                    {% endif %}
                    
                    {% if user.is_anonymous == False %}
                    <div>
                        {% for offer in list_offer %}  
                            {% if offer.user.id == user.id and offer.post.id == post.id%}
                        <a href="#openModal3"><p id="myBtn2"> View your offer. </p></a>
                        {%endif%}
                        {%endfor%}
                    </div>
                    {% endif %}
                </div>
                
                <div class = "detail-info">
                    <div>Itemname: {{post.itemname}}</div>
                    <div>Quantity x {{post.quantity}}</div>
                    <div>Condition: <a href = "{% url 'market:searchcondition' post.condition %}"> {{post.me}}</a></div>
                    <div>Type: <a href = "{% url 'market:searchtype' post.posttypes %}">{{post.posttypes}}</a></div>
                    {%if post.posttypes == "Academic"%}
                    <div>Course Name: <a href = "{% url 'market:searchcourse' post.coursename %}">{{post.coursename}}</a></div>
                    {%endif%}
                    <div>Tag:<a href = "{% url 'market:searchtag' post.tag %}"> #{{post.tag}}</a></div>
                   <div> posted by <a href = "{% url 'market:user' post.user.id %}">{{post.user.username}}</a></div>
                </div>
                    
                

               
            </div>

            <div id="openModal1" class="modalDialog">
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                    <img  src= "{{ post.tb_img.url }}" id="photo" alt="No photo loaded yet">
                </div>
            </div>
            
            <!-- The Modal -->
            <div id="openModal2" class="modalDialog">
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                    <div>{{post.itemname}}</div>
                    <form action="" method="GET" >
                        {% csrf_token %}
                        
                        <div>
                        <label for="offertype">Type of Offer: </label>
                        <select name="offertype" id="offertype">
                        <option value="" disabled selected>Select your option</option>
                        <option value = "Purchase">Purchase</option>
                        <option value = "Exchange">Exchange</option>
                        </select>  
                        </div>
                        
                        <div id="items">
                        <label for="items">Your Items: </label>
                        <select name="items">
                            <option value="" disabled selected>Select an item</option>
                            
                            {%for items in buyeritems%}
                            <option value = "{{items.id}}">{{items.itemname}}</option>
                            {%endfor%}
                        </select>
                        </div>
                    <div id="amount">
                        <label for="amount"> Amount Due: </label>
                            <input type="number" name="amount" min=0>
                    </div>
                        <button type="submit" class="button" onclick=""> SUBMIT </button>  
                    </form>
                </div>
            </div>
            
            <div id ="openModal3" class = "modalDialog">
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                    <form action ="">
                         <div id = detailoff>
                            {% for offer in list_offer %}  
                            {% if offer.user.id == user.id and offer.post.id == post.id%}
                             <div class = offername>Offer name:{{offer.post.itemname}}</div>
                                <div class = offertype>Offer Type: For {{offer.offertypes}}</div>
                                    {% if offer.offertypes == "Purchase" %}
                                        <div class = amount>Amount: P{{offer.amount}}</div>
                                    
                                    {% elif offer.offertypes == "Exchange" %}
                                        <div class = amount>Exchange Post: {{offer.exchangepost}}</div>
                                    {% endif%}
                            <input type="submit" class="button" value = "Update"/>
                            {% endif%}
                            {%endfor%}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
    <script>
        $(document).ready(function () {
            $("#amount").hide();
            $("#items").hide();
            if(window.location.href.indexOf("userid") != -1) {
                window.location.hash = '#openModal2';
            }
            $("#offertype").change(function(){
                if(this.value == 'Exchange') {
                    $("#amount").hide();
                    $("#items").show();
                } else if(this.value == 'Purchase') {
                    $("#items").hide();
                    $("#amount").show();
                }
            })
        });
    </script>
</html>
