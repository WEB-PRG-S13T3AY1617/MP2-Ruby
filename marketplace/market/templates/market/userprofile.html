{% load static %}
<html>
	<head><title>User Profile</title>
		<link rel="stylesheet" type="text/css" href="{%static 'market/userstyle.css' %}"/>
      
	</head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
        <script>
        $(document).on("keypress", ".search", function(e) {
            if (e.which == 13) {
            
            }
        });
    
</script>
    
   	<body>
        <div id = page>
			<div class = "bar-container">
                <div class = "bar">
                    <div class = "item-container">
                        {% if user.is_authenticated == True %}
                        <div class = "bar-item">Hi, <a href="{% url 'market:user' user.id %}"> {{ user.username }} </a> !</div>
                        {% else %}
                        <a href="/register/"><div class = "bar-item">Register</div></a>
                        {% endif %}
                        
                        {% if user.is_authenticated == True %}
                        <a href="/logout/">
                            <div class = "bar-item">Logout</div>
                            </a>
                        {% else %}
                        <a href="/login/">
                            <div class = "bar-item">Login</div>
                        </a>
                         {% endif %}
                    </div>
                </div>
            </div>
            <div class = "bar-container">
                <div class = "a-container">
                    <div class = "left-container"> </div>
                    <div class = "middle-container">
                        <img src = "{%static 'photos/rccshop.png' %}" width="300" height="200" class = "rcc"/>
                    </div>
                    <div class = "right-container">
     <form action="{% url 'market:searchpic' %}">
     	<input type="text" class="search" name = "tag" placeholder="Search tag..." style="background-image:url('{%static 'photos/magnifyglass.png' %}')">
     </form>
</div>

                </div>
            </div>
            <div class = "bar-container">
                <div class = "menu">
                    <div class = "b-container">
                        <a href="/market"><div class = "home"> <span class = "t"> Home </span> </div></a>
                        <a href="/market/postanitem"><div class = "ppost"> <span class = "s"> Post an Item </span> </div></a>
                    </div>
                </div>
            </div>
            
			<div class = full_container>
				<div class = mydata>
					<div class = name_container>
                        <div class = name_text>{{user2.first_name}} {{user2.last_name}}</div>
                        <div></div>
                        <div class = uname>@{{user2.username}}</div>
                    
                    </div>
                
                    
                    <div id = info_container>
                        <div class = listinfo>
                                <div class = types ><span>User Type : {{userprof.usertypes}}</span></div>
                                <div class = types_place ><span>Degree Program/Office :  {{userprof.Degree_Program_or_Office}}</span></div>
                                
                        </div>
       
                    </div>
                      {%if user.username == user2.username %}
                    <div id = offer_container>
                        <div class =  offerinfo>
                            <div class = offer><span>OFFER</span></div>
                            <form action="" method="get">
                            <div class = list >
                             {% for offer in list_offer %}   
                                {% for post in latest_posts %} 
                                    {%if offer.post == post and offer.status != 2 %}
                                    
                                <a href="?offerid={{offer.id}}"><div id="obj" name="offerby">{{offer.post.itemname}} made by {{offer.user.username}}</div></a>
                                    {%endif%}
                                {% endfor %}
                            {% endfor %}
                            </div>
                            </form>
                        </div>
                    </div>
                    {%endif%}
				</div>
					
				
				
				
				<div id = psection>
					{% if latest_posts %}
					<div id = post_container>
                        {% for post in latest_posts %}
                        <div id = post_box>
                            <div class = post id = 1 >
                               <a href = "{% url 'market:itemdetail' post.id %}"><img src = "{{ post.tb_img.url }}" id ="thumb"  alt="no photo loaded yet"></a>
                                <div class = info>
                                    <div>{{post.itemname}}</div>
                                    <div>#{{post.tag}}</div>
                                     
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}
                      
                        </div>
                       
                        <div class="pagination">
                    <span class="step-links">
                        {% if latest_posts.has_previous %}
                        <a href="?page={{ latest_posts.previous_page_number }}">previous</a>
                        {% endif %}

                        <span class="current">
                            Page {{ latest_posts.number }} of {{ latest_posts.paginator.num_pages }}.
                        </span>

                        {% if latest_posts.has_next %}
                        <a href="?page={{ latest_posts.next_page_number }}">next</a>
                        {% endif %}
                    </span>
					</div>
					</div>
				</div>
                
               
		
            </div>
             
            <div id="openModal1" class="modalDialog">
                <div>
                    <a href="#x" title="Close" class="x"><span class="close2">&times;</span></a>
                     {%if offerobj != None and offerobj.status != 2%}
                     <div id = detailoff>
                         <div class = "offername">{{offerobj.post.itemname}}</div>
                         <img src={{offerobj.post.tb_img.url}} alt="no photo avail" width="60" height="60"  />
                         <div class = offertype>Offertype: For {{offerobj.offertypes}}</div>
                         <div class = amount>Amount: P{{offerobj.amount}}</div>
                         {%if offerobj.status == 0%}
                         <div class = status>Status: Available</div>
                         {% endif %}
                         {%if offerobj.status == 1%}
                         <div class = status>Status: Already Bought!</div>
                         {% endif %}
                         <div class = "offerby">Offer made by <a href = "{% url 'market:user' offerobj.user.id %}">@{{offerobj.user.username}}</a></div>
                         <div class = date>Date offered: {{offerobj.pub_date}}
                         </div>
                         <div id="btnbox2">
                             <div id="btna"class="btnacc" name="accept" onclick="openbtnboxA();">Accept</div>
                             <div class="spacer"></div>
                             
                             <div id="btnd"class="btndec" name="decline" onclick="openbtnboxD();">Decline</div>
                             <div class="spacer"></div>

                         </div>
                    </div>
                    <div id = confirm>
                        <div class ="confirmname">Confirmation</div>
                         <div id="btnbox">
                             <div class ="btn">
                            <form action="{% url 'market:accept' offerobj.id %}" method="post"> <!--post updates the value instead of GET-->
                               <div id="reasonA" >Reason:<br><input type="text" name="reason" value=""></div>
                            {% csrf_token %}
                                <button  class="btnacc"  name="accept" type="submit" > Accept</button>
                                <div class="spacer"></div>
                             </form>
                            <form action="{% url 'market:decline' offerobj.id %}" method="post">
                                {% csrf_token %}
                                <div id="reasonD" >
                                    Reason:<br><input type="text" name="reason" value=""></div>
                                <button class="btndec" name="decline" type="submit" >Decline</button>
                                <div class="spacer"></div>
                            </form>
                            </div>
                         </div>
                    </div>
                         
                    
                    </div>
                    {%endif%}
                      
                   
                </div>
            </div>
           
         <script>
             $(document).ready(function () {
                if(window.location.href.indexOf("offerid") != -1) 
                {
                   window.location.hash = '#openModal1';
                   $("#confirm").css({"visibility": "hidden"});
                
                  //  $("#detailoff").css({"visibility": "hidden"});
                }
            });
            function closeModal()
             {
                  window.location.hash = '#x';
             }
             function openbtnboxA()
             {
                  $("#confirm").css({"visibility": "visible"});
                 $("#reasonD").css({"visibility": "hidden"});
                 $("#detailoff").css({"visibility": "hidden"});
             }
          
             function openbtnboxD()
             {
                  $("#confirm").css({"visibility": "visible"});
                 $("#reasonA").css({"visibility": "hidden"});
                 $("#detailoff").css({"visibility": "hidden"});
             }
        </script>
	</body>
  
</html>